âŸ¨Atom,nil,Err,_chk,_chksâŸ© â† â€¢Import "globals.bqn"
âŸ¨EnvâŸ© â† â€¢Import "env.bqn"
âŸ¨PrStr,PrStrRâŸ© â† â€¢Import "printer.bqn"
âŸ¨ReadStrâŸ© â† â€¢Import "reader.bqn"

Q â† {âˆ¾Â´'"'âˆ¾ğ•©âˆ¾'"'}
J â† {0=â‰ ğ•© ? "" ;
     1=â‰ ğ•© ? âŠ‘ğ•© ;
     âˆ¾Â´(âŠ‘ğ•©)âˆ¾ğ•¨âˆ¾ğ•¨J 1â†“ğ•©}
E â† {ğ•Š âŸ¨tâ€¿a,sâ€¿bâŸ©:
      {(âŠ‘tâˆŠ3â€¿4) âˆ§ âŠ‘sâˆŠ3â€¿4 ?
       {(â‰ a)=â‰ b ? âˆ§Â´a EÂ¨b ; 0};
       (tâ‰¡s)âˆ§aâ‰¡b} ;
     {2<â‰ ğ•© ? âˆ§Â´EÂ´Ë˜2â†•ğ•© ; 1}ğ•©}

ns â† âŸ¨
  "+"â€¿{1âˆ¾+Â´1âŠË˜>ğ•©}
  "-"â€¿{1âˆ¾-Â´1âŠË˜>ğ•©}
  "*"â€¿{1âˆ¾Ã—Â´1âŠË˜>ğ•©}
  "/"â€¿{1âˆ¾âŒŠâˆ˜Ã·Â´1âŠË˜>ğ•©}

  "="â€¿{7âˆ¾Eğ•©}
  "<"â€¿{7âˆ¾âˆ§Â´<Â´Ë˜2â†•1âŠ¸âŠ‘Â¨ğ•©}
  "<="â€¿{7âˆ¾âˆ§Â´â‰¤Â´Ë˜2â†•1âŠ¸âŠ‘Â¨ğ•©}
  ">"â€¿{7âˆ¾âˆ§Â´>Â´Ë˜2â†•1âŠ¸âŠ‘Â¨ğ•©}
  ">="â€¿{7âˆ¾âˆ§Â´â‰¥Â´Ë˜2â†•1âŠ¸âŠ‘Â¨ğ•©}

  "empty?"â€¿{7âˆ¾0=â‰ 1âŠ‘âŠ‘ğ•©}
  "count"â€¿{1âˆ¾â‰ 1âŠ‘âŠ‘ğ•©}

  "bqn-show"â€¿{â€¢Show âŠ‘ ğ•©}
  "pr-str"â€¿{2âˆ¾<" "J PrStrRÂ¨ğ•©}
  "str"â€¿{2âˆ¾<""J PrStrÂ¨ğ•©}
  "prn"â€¿{â€¢Out " "J PrStrRÂ¨ğ•© â‹„ nil}
  "println"â€¿{â€¢Out " "J PrStrÂ¨ğ•© â‹„ nil}

  "read-string"â€¿{ReadStr 1âŠ‘âŠ‘ğ•©}
  "slurp"â€¿{2âˆ¾<â€¢FChars 1âŠ‘âŠ‘ğ•©}

  "atom"â€¿{11âˆ¾Atom âŠ‘ğ•©}
  "atom?"â€¿{7âˆ¾11=âŠ‘âŠ‘ğ•©}
  "deref"â€¿{ğ•Š âŸ¨11â€¿aâŸ©: a.Deref@; Err "deref: not an atom"}
  "reset!"â€¿{
    ğ•Š âŸ¨11â€¿a,vâŸ©: a.Reset v;
    Err "reset!: not an atom"}
  "swap!"â€¿{
    âŸ¨tâ€¿a,fnâŸ© â† 2â†‘ğ•©
    args â† (<a.Deref@) âˆ¾ 2â†“ğ•©
    f â† {9â€¿f: f; 10â€¿xâ€¿yâ€¿zâ€¿f: f}fn
    a.Reset F args}

  "cons"â€¿{ğ•Š xâ€¿âŸ¨t,xsâŸ©: 3âˆ¾<(<x)âˆ¾xs ; Err "cons"}
  "concat"â€¿{ğ•Š âŸ¨âŸ©:3â€¿âŸ¨âŸ©; 3âˆ¾<âˆ¾Â´1âŠ¸âŠ‘Â¨ğ•©}

  "nth"â€¿{ğ•Š âŸ¨tâ€¿xs,1â€¿nâŸ©: {n<â‰ xs ? nâŠ‘xs ; Err "out of bounds"}}
  "first"â€¿{S âŸ¨tâ€¿xsâŸ©: {0<â‰ xs ? âŠ‘xs ; nil}; nil}
  "rest"â€¿{ğ•Š âŸ¨tâ€¿âŸ¨âŸ©âŸ©: 3â€¿âŸ¨âŸ©; ğ•Š âŸ¨tâ€¿xsâŸ©: 3âˆ¾<1â†“xs; 3â€¿âŸ¨âŸ©}

  "throw"â€¿{ğ•Š âŸ¨xâŸ©: Â¯1â€¿x}

  "apply"â€¿{ğ•Š
    fn â† {9â€¿f:f; 10â€¿bâ€¿aâ€¿eâ€¿f: f}âŠ‘ğ•©
    args â† (Â¯1â†“1â†“ğ•©)âˆ¾1âŠ‘Â¯1âŠ‘ğ•©
    Fn _chks args}
  "map"â€¿{ğ•Š
    fn â† {9â€¿f:f; 10â€¿bâ€¿aâ€¿eâ€¿f: f}âŠ‘ğ•©
    {3âˆ¾<ğ•©}_chks{Fn âŸ¨ğ•©âŸ©}Â¨ 1âŠ‘1âŠ‘ğ•©}

  "nil?"â€¿{ğ•Š âŸ¨8â€¿âŸ¨âŸ©âŸ©: 7â€¿1; 7â€¿0}
  "true?"â€¿{ğ•Š âŸ¨7â€¿1âŸ©: 7â€¿1; 7â€¿0}
  "false?"â€¿{ğ•Š âŸ¨7â€¿0âŸ©: 7â€¿1; 7â€¿0}
  "symbol?"â€¿{ğ•Š âŸ¨0â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "keyword?"â€¿{ğ•Š âŸ¨6â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "vector?"â€¿{ğ•Š âŸ¨4â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "list?"â€¿{ğ•Š âŸ¨3â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "map?"â€¿{ğ•Š âŸ¨5â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "sequential?"â€¿{ğ•Š âŸ¨3â€¿xâŸ©: 7â€¿1; ğ•Š âŸ¨4â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "string?"â€¿{ğ•Š âŸ¨2â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "number?"â€¿{ğ•Š âŸ¨1â€¿xâŸ©: 7â€¿1; 7â€¿0}
  "fn?"â€¿{7âˆ¾{9:1;10:1;0}âŠ‘âŠ‘ğ•©}

  "symbol"â€¿{0âˆ¾<1âŠ‘âŠ‘ğ•©}
  "keyword"â€¿{ğ•Š âŸ¨6â€¿kwâŸ©: 6â€¿kw;
             ğ•Š âŸ¨2â€¿sâŸ©: 6âˆ¾<':'âˆ¾s}
  "list"â€¿{3â€¿ğ•©}
  "vector"â€¿{4â€¿ğ•©}
  "hash-map"â€¿{5â€¿ğ•©}
  "vec"â€¿{ğ•Š âŸ¨4â€¿xâŸ©: 4â€¿x; ğ•Š âŸ¨3â€¿xâŸ©: 4â€¿x}

  "keys"â€¿{ğ•Š âŸ¨5â€¿xsâŸ©: 3âˆ¾<â¥ŠâŠË˜âˆ˜â€¿2â¥Šxs}
  "vals"â€¿{ğ•Š âŸ¨5â€¿xsâŸ©: 3âˆ¾<â¥Š1âŠË˜âˆ˜â€¿2â¥Šxs}
  "get"â€¿{ğ•Š âŸ¨5â€¿xs,kâŸ©: 1âŠ‘@â€¿nilâˆ¾Ëœâ¥Š(kâŠ¸â‰¡Ë˜âŠ‘Ë˜)âŠ¸/âˆ˜â€¿2â¥Šxs; nil}
  "contains?"â€¿{ğ•Š âŸ¨5â€¿xs,kâŸ©: 7âˆ¾Ã—+Â´kâŠ¸â‰¡Ë˜âŠ‘Ë˜âˆ˜â€¿2â¥Šxs}
  "dissoc"â€¿{ğ•Š âŸ¨xâŸ©: x;
    âŸ¨tâ€¿xs,kâŸ© â† 2â†‘ğ•©
    ğ•Š (2â†“ğ•©)âˆ¾Ëœ<5âˆ¾<â¥Š(kâŠ¸â‰¢Ë˜âŠ‘Ë˜)âŠ¸/âˆ˜â€¿2â¥Šxs}
  "assoc"â€¿{ğ•Š âŸ¨xâŸ©: x;
    âŸ¨tâ€¿xs,k,vâŸ© â† 3â†‘ğ•©
    ğ•Š (3â†“ğ•©)âˆ¾Ëœ<5âˆ¾<kâ€¿vâˆ¾Ëœâ¥Š(kâŠ¸â‰¢Ë˜âŠ‘Ë˜)âŠ¸/âˆ˜â€¿2â¥Šxs}

  "readline"â€¿{ğ•Š âŸ¨2â€¿sâŸ©:
    â€¢term.OutRaw s
    in â† â€¢GetLine 0
    {inâ‰¡@ ? nil ; 2â€¿in}}

  "time-ms"â€¿{ğ•Šâ‹„1âˆ¾âŒŠ1000Ã—â€¢MonoTime@}

  "meta"â€¿(Â¯1â€¿"NYI")
  "with-meta"â€¿(Â¯1â€¿"NYI")
  "seq"â€¿(Â¯1â€¿"NYI")
  "conj"â€¿(Â¯1â€¿"NYI")
âŸ©

core â‡ Env@
{ğ•Š kwâ€¿f: core.Set kwâ€¿(9â€¿f)}Â¨ns

core.Set "*host-language*"â€¿(2â€¿"BQN")
core.Set "*ARGV*"â€¿âŸ¨3,âŸ¨âŸ©âŸ©
