Reader â† {ğ•Š tokens:
  {
    ts â† tokens
    Peek â‡ {ğ•Š â‹„ âŠ‘ ts}
    Next â‡ {ğ•Š
      t â† âŠ‘ts
      ts â†© 1â†“ts
      t
    }
  }
}

T â† {ğ•Š s:
  {
    0=â‰ s ? âŸ¨âŸ© ;
    @=âŠ‘s ? â€¢Exit 0 ;
    "~@"â‰¡2â†‘s ? (<"~@") âˆ¾ T 2â†“s ;
    âŠ‘(âŠ‘s)âˆŠ" ,"âˆ¾@+10 ? T 1â†“s ;
    âŠ‘(âŠ‘s)âˆŠ"[]{}()'`~" ? (<â‰âŠ‘s) âˆ¾ T 1â†“s ;
    ';'=âŠ‘s ?
      oâ†âŸ¨âŸ©
      {ğ•Š
        o âˆ¾â†© âŠ‘s
        s â†© 1â†“s
        (âŠ‘s) â‰  @+10
      } â€¢_while_âŠ¢1
      (<o) âˆ¾ T s ;
    '"'=âŠ‘s ?
      oâ€¿pâ€¿r â† """"â€¿1â€¿1
      {ğ•Š
        s â†© 1â†“s
        c â† âŠ‘s
        o âˆ¾â†© c
        q â† pâˆ§c='"'
        {p ? pâ†©câ‰ '\' ; pâ†©1}
        r â†© 1<â‰ s
        râˆ§Â¬q
      } â€¢_while_âŠ¢1
      {r?@;â€¢Out "unterminated string: "âˆ¾o}
      (<o) âˆ¾ T 1â†“s ;
    oâ†âŸ¨âŸ©
    {ğ•Š
      o âˆ¾â†© âŠ‘s
      s â†© 1â†“s
      {0=â‰ s ? 0 ; Â¬âŠ‘(âŠ‘s)âˆŠ"[]{}()'""`~,; "âˆ¾@+10}
    } â€¢_while_âŠ¢1
    (<o) âˆ¾ T s
  }
}

# Types:
# 0 symbol
# 1 int
# 2 string
# 3 list
Atom â† {ğ•Š a:
  {'"': 2âˆ¾<Â¯1â†“1â†“a ;
   âŠ‘ğ•©âˆŠ"0123456789" ? 1âˆ¾10âŠ¸Ã—âŠ¸+ËœÂ´'0'-ËœâŒ½a ;
   0â€¿a }âŠ‘a
}

ReadList â† {ğ•Š r:
  lâ†âŸ¨âŸ©
  {ğ•Š
    l âˆ¾â†© <ReadForm r
    ")"â‰¢r.Peek@
  }â€¢_while_âŠ¢1
  r.Next@
  3â€¿l
}

ReadForm â† {ğ•Š r:
  {"(": ReadList r ;
   Atom ğ•©
  }r.Next@
}

{
  Tokenize â‡ T
  ReadStr â‡ ReadFormâˆ˜Readerâˆ˜Tokenize
}
