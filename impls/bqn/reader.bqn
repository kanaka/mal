Reader â† {ğ•Š tokens:
  {
    ts â† tokens
    Peek â‡ {ğ•Š â‹„ âŠ‘ tokens}
    Next â‡ {ğ•Š
      t â† âŠ‘ts
      ts â†© 1â†“ts
      t
    }
  }
}

T â† {ğ•Š s:
  {
    0=â‰ s ? âŸ¨âŸ© ;
    "~@"â‰¡2â†‘s ? (<"~@") âˆ¾ T 2â†“s ;
    âŠ‘(âŠ‘s)âˆŠ" ,"âˆ¾@+10 ? T 1â†“s ;
    âŠ‘(âŠ‘s)âˆŠ"[]{}()'`~" ? (<â‰âŠ‘s) âˆ¾ T 1â†“s ;
    ';'=âŠ‘s ?
      oâ†âŸ¨âŸ©
      {ğ•Š
        o âˆ¾â†© âŠ‘s
        s â†© 1â†“s
        (âŠ‘s) â‰  @+10
      } â€¢_while_âŠ¢1
      (<o) âˆ¾ T s ;
    '"'=âŠ‘s ?
      oâ€¿pâ€¿r â† """"â€¿1â€¿1
      {ğ•Š
        s â†© 1â†“s
        c â† âŠ‘s
        o âˆ¾â†© c
        q â† pâˆ§c='"'
        {p ? pâ†©câ‰ '\' ; pâ†©1}
        r â†© 1<â‰ s
        râˆ§Â¬q
      } â€¢_while_âŠ¢1
      {r?@;â€¢Out "unterminated string: "âˆ¾o}
      (<o) âˆ¾ T 1â†“s ;
    oâ†âŸ¨âŸ©
    {ğ•Š
      o âˆ¾â†© âŠ‘s
      s â†© 1â†“s
      Â¬âŠ‘(âŠ‘s)âˆŠ"[]{}()'""`~,; "âˆ¾@+10
    } â€¢_while_âŠ¢1
    (<o) âˆ¾ T s
  }
}

T "  ( ,~@,, ""ohai"" )  ; comment" âˆ¾ (@+10) âˆ¾ "(token + 2)"

{
  Tokenize â‡ T
  Read_str â‡ Readerâˆ˜Tokenize
}
