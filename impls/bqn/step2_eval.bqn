âŸ¨ReadStrâŸ© â† â€¢Import "reader.bqn"
âŸ¨PrStrRâŸ© â† â€¢Import "printer.bqn"

replEnv â† >âŸ¨
  "+"â€¿1â€¿(+Â´)
  "-"â€¿1â€¿(-Â´)
  "*"â€¿1â€¿(Ã—Â´)
  "/"â€¿1â€¿(Ã·Â´)
âŸ©
Undef â† {@â€¿Â¯1â€¿(<"undefined: "âˆ¾ğ•©)}

EvalAst â† {env ğ•Š tâ€¿v:
  {0: idx â† âŠ‘((âŠË˜env)âŠ(<v))
      {idx<â‰ env ? idxâŠenv ; Undef v};
   3: envâŠ¸EVALÂ¨v ;
   tâ€¿v
  }t
}

READ â† ReadStr
PRINT â† PrStrR
EVAL â† {
  env ğ•Š 3â€¿âŸ¨âŸ©: 3â€¿âŸ¨âŸ© ;
  env ğ•Š 3â€¿xs: {
    ys â† env EvalAst 3â€¿xs
    nâ€¿tâ€¿f â† âŠ‘ys
    zs â† 1â†“ys
    tâˆ¾F 1âŠ¸â†“Â¨zs
  } ;
  env ğ•Š 4â€¿xs: 4âˆ¾<envâŠ¸EVALÂ¨xs ;
  env ğ•Š 5â€¿xs: 5âˆ¾<envâŠ¸EVALÂ¨xs ;
  env ğ•Š x: env EvalAst x
}
Rep â† PRINTâˆ˜{replEnv EVAL ğ•©}âˆ˜READ

{
  â€¢Out "user> "
  line â† â€¢GetLine 0
  â€¢Out Rep line
  ğ•Šğ•©
}@
